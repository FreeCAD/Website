{{- define "main" -}}

{{- if not hugo.IsProduction -}}
  {{- partial "debug.html" . -}}
{{- end -}}

<header>
  {{- if or (eq .Section "news") (eq .Kind "term") -}}
    <ul class="category-list">
      {{- range site.Sites.Default.Taxonomies.categories -}}
        <li>
          <a href="{{ .Page.RelPermalink }}">
            {{ .Page.LinkTitle }}
          </a>
        </li>
      {{- end -}}
    </ul>
  {{- end -}}

  <h1 class="title">
    {{- if eq .Kind "term" -}}
      {{ .Data.Singular | title }}: {{ end }}
    {{ .Title | .RenderString }}
  </h1>

  {{- if .Description -}}
    <h3 class="description">
      {{ .Description | .RenderString }}
    </h3>
  {{- end -}}

  {{- with .Params.cards -}}
    {{- partial "hero_cards.html" . -}}
  {{- end -}}

  {{- if eq .Kind "term" -}}
    {{- with .Site.GetPage "news" -}}
      {{- partial "hero_cover.html" . -}}
    {{- end -}}
  {{- else -}}
    {{- partial "hero_cover.html" . -}}
  {{- end -}}
</header>

{{- if eq .Type "guide" }}
  {{- partial "content.html" . -}}
{{- end -}}

{{/* get the latest pages from the current section, and fill in the missing translated pages from the first site (currently English) */}}
{{- $pages := where (.RegularPages | lang.Merge site.Sites.Default.RegularPages) "Section" .Section -}}

{{- if eq .Type "contribute" }}
  {{- $lang := slice -}}
  {{- range .Translations -}}
    {{- $lang = $lang | append .Sections -}}
  {{- end -}}
  {{- $pages = where (lang.Merge .Sections $lang) "Type" "guide" -}}
  {{- $pages = $pages | append (.Site.GetPage "telemetry")}}
{{- end -}}

{{- if or (eq .Kind "term") (eq .Type "guide") -}}
  {{- $pages = .RegularPages -}}
{{- end -}}

{{- partial "list_paginator.html" (dict "pages" $pages "context" .) -}}

{{- end -}}
{{- /* end main */ -}}
