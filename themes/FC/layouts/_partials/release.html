{{- $params := .Params -}}
{{- $platforms := slice -}}
{{- $thanks := "" | default "Thank you for downloading FreeCAD!" -}}
{{- $donate := "" | default "Donate for its development" -}}
{{- $downloadPage := site.GetPage "download" | default (site.Sites.Default.GetPage "download") -}}
{{- with $downloadPage -}}
  {{- with .Params.platforms -}}
    {{- $platforms = . -}}
  {{- end -}}
  {{- with .Params.thanksText -}}
    {{- $thanks = . -}}
  {{- end -}}
{{- end -}}

<form class="download-box">
  {{- range $platform := $platforms -}}
    <div class="cards-column" id="{{ $platform.id }}" style="order: {{ $platform.order }};">
      {{- range $download := $platform.downloads -}}
        {{- with index $params (printf "%s_%s" $platform.id $download.key) -}}
          <button class="arch-icon"
            type="submit"
            formaction="{{ . }}"
            alt="{{ $download.alt }}"
            aria-label="{{ $download.label }}"
            title="{{ $download.label }}"
            download>
            {{- safeHTML (index site.Data.svg $download.key) -}}<br>
            <span>
              {{ $download.label }}
            </span>
          </button>
        {{- end -}}
      {{- end -}}

      <button type="button"
        popovertarget="{{ $platform.id }}-arch"
        title="{{ $platform.label }}">
        {{- safeHTML (index site.Data.svg $platform.id) -}}<br>
        <span>
          {{ $platform.label }}
        </span>
      </button>
      <span popover id="{{ $platform.id }}-arch"></span>
    </div>
  {{- end -}}
</form>